
# Требования
## Функциональные требования
* Возможность выставления разных квот для разных клиентов
* Возможность пересчитать коэффициенты нагрузки при падении одной из нод лимитера
## Нефункциональные требования
* Высокая доступность (99.9%)
* Масштабируемость
* Время ответа 1 мс 

Предполагаем число уникальных пользователей 1 млн, ежесекундное число активных пользователей 50 тысяч. Средняя нагрузка предполагается 2 запроса в секунду - нагрузка на лимитер 100 тысяч запросов в секунду. Исходя из требования в 1 мс на время отклика, необходимо не менее 100 вычислительных ядер, или не менее 7 физических серверов с 16-ядерными ЦП.

Для заданных требований был выбра протокол HTTP и модель синхронного взаимодействия между сервисом и рейт-лимитером, так как сессии короткие и многочисленные, а время ответа невелико. 

## Модель данных

### БД
* Айди клиента - int (4 байта)
* Квота на число запросов - 4 байта
Размер временного окна в мс - 4 байта
На 1.000.000 пользователей 11.44 Мбайт

### ОЗУ
* Id клиента - 4 байта
* Ссылка на лимитер - 4 байта
* Размер окна в мс - 8 байт
Максимальное число запросов в окне - 4 байта
На 1.000.000 клиентов имеем ~19.07 Мбайт данных 

Каждое окно в лимитере содержит:
* Айди окна - 8 байт
* Число запросов в данном окне - 16 байт - AtomicInteger
Общий размер 24 байта.
Если каждое окно имеет длину порядка минуты, предполагаем очистку раз в час. Следовательно, постоянно будет храниться 60 окон. 
На пользователя - 1440 байт. На 1.000.000 пользователей ~1.34 Гбайт данных.
